%% AMS-LaTeX Created by Wolfram Mathematica 9.0 : www.wolfram.com

\documentclass{article}
\usepackage{amsmath, amssymb, graphics, setspace}
\usepackage{graphicx}

\usepackage[utf8]{inputenc}
\usepackage{spverbatim}
\usepackage{geometry}
 \geometry{
 a4paper,
 left=15mm,
 right=10mm,
 top=20mm,
 bottom=20mm,
 }

\DeclareMathSizes{10}{10}{10}{10}

\newcommand{\mathsym}[1]{{}}
\newcommand{\unicode}[1]{{}}

\newcounter{mathematicapage}
\begin{document}


\section{Ondas de sonido}
Una perturbación de pequeña amplitud en un fluido va a crear zonas de compresión y rarefacción que alternan en el tiempo y espacio en la dirección de propagación(el movimiento oscilatorio de las particulas se propaga como una onda y son ondas logitudinales:  las particulas se mueven en la misma dirección que la dirección de propagación)

\paragraph{Condiciones iniciales}
Consideramos un fluido ideal con las variables velocidad, densidad y presión(dependen de x y t) en el estado de equilibrio $v_{00} = 0, \rho_0 , p_0$ y hacemos unos cambios en estas variables añadiendo unas perturbaciones:
$ v, \rho\prime, p\prime $ 
que  son muy pequeños de forma que se pueden omitir los términos de segundo orden (o mayores) en las ecuaciones de los fluidos.
Definimos $c_s = =\big( \frac{\partial p}{\partial \rho}\big)_s  $

 $c_s(x) = sqrt{\gamma \frac{p_0}{\rho_0}}$

Las variables de cuales queremos estudiar la evolución devienen:

\begin{description}  
\item v
\item $\rho = \rho_0 + \rho\prime$
\item $p = p_0 + p\prime$

 
\end{description}  

con $|v|<<c_s, p\prime<<p , \rho\prime << \rho_0$ 

Las ecuaciones de los fluidos despues de linearizar devienen:
\begin{description}  
\item continuidad: $ \frac{\partial \rho\prime}{\partial t} + \rho_0 \nabla \cdot v = 0 $
\item Euler: $ \frac{\partial v}{\partial t} + \frac{1}{\rho_0} \nabla p\prime = 0 $

\end{description}  

\begin{description}  
\item El proceso es adiabático: $p\prime = c_s^{2} \rho\prime$

\item Después de hacer los cálculos (y suponiendo el caso general inhomogeneo en tiempo y espacio : $\rho_0 = \rho_0(x,t) \implies c_s = c_s(x,t)$ con la densidad de equilibrio variando bastante lentamente en el espacio y tiempo de tal forma que se pueden omitir terminos de segundo orden o mas en multiplicaciones de derivadas temporales o espaciales de estas y las perturbaciones) las perturbaciones de las variables verifican las ecuaciones: 

\item $\frac{\partial}{\partial t} \big(\frac{1}{c_s^{2}(x,t)} \frac{\partial p\prime}{\partial t}\big) = \nabla^{2} p\prime    $
\item $\frac{\partial}{\partial t} \big(\frac{1}{c_s^{2}(x,t)} \frac{\partial \rho\prime}{\partial t}\big) = \nabla^{2} \rho\prime    $
\item $\frac{\partial}{\partial t} \big(\frac{1}{c_s^{2}(x,t)} \frac{\partial \Phi}{\partial t}\big) = \nabla^{2} \Phi $ donde definimos  $v = \nabla \Phi$ considerando el fluido irrotacional
(\small{he mencionado este caso general con la variación de $\rho_0$ también  en el tiempo porque en la documentación que he leído se consideraba así})

\item Si la densidad de equilibrio no varia en el tiempo($\rho_0 = \rho_0(x)$):
\item $\frac{1}{c_s^{2}(x)} \frac{\partial^{2} p\prime}{\partial t^{2}} = \nabla^{2} p\prime    $
\item $\frac{1}{c_s^{2}(x)} \frac{\partial^{2} \rho\prime}{\partial t^{2}} = \nabla^{2} \rho\prime    $
\item $\frac{1}{c_s^{2}(x)} \frac{\partial^{2} \Phi}{\partial t^{2}} = \nabla^{2} \Phi    $
\end{description}  

\paragraph{Medio homogéneo}

\begin{description}  
\item Si la densidad de equilibrio es constante en tiempo y espacio ($\rho_0, c_s constantes$) las soluciones generales son superposiciones de ondas planas de forma:
\item $ \sum_{i} A_{\rho\prime_i} cos (x - csSign_i c_s t) $
\item $ \sum_{i} A_{p\prime_i} cos (x - csSign_i c_s t) $
\item $ \sum_{i} csSign_i A_{v_i} cos (x - csSign_i c_s t) $ 
\item con las amplitudes números reales verificando las ecuaciones:
$A_{p\prime_i} = c_s^{2} A_{\rho\prime_i}$
$A_{v_i} = \frac{1}{c_s \rho_0} A_{p\prime_i}$
\item y en los  casos $csSign_i = 1, A_{\rho\prime_i}, A_{p\prime_i}, A_{v_i} > 0$ y 
$csSign_i = -1, A_{\rho\prime_i}, A_{p\prime_i}, A_{v_i} < 0$  la onda viaja a la derecha
\item y cuando $csSign_i = -1, A_{\rho\prime_i}, A_{p\prime_i}, A_{v_i} > 0$ y 
$csSign_i = 1, A_{\rho\prime_i}, A_{p\prime_i}, A_{v_i} < 0$  la onda va a la izquierda

\end{description}  


\paragraph{Medio inhomogéneo}. La densidad varía lentamente en el espacio  $\rho_0 = \rho_0(x)$
La solución no se puyede expresar mas como superposición de ondas planas (porque $c_s$ no es más constante ), pero análogo a esta solución intentamos  buscar soluciones de forma $a(x,t) e^{i\phi(x,t)}$ (aproximación WKB):
 donde definimos 
\begin{description}  
\item $\omega(x,t) = -\frac{\partial \phi}{\partial t}$
\item $k(x,t) = -\nabla \phi$
\end{description}
porque análogo al caso homogeneo (considerando sin perder la generlaidad solo una onda y no una superposición) donde $\phi(x,t) = kx-\omega t$ con $\omega, k$ constantes verificando la relación de dispersión $\omega^{2} = c_s^2 k^2  $  


\paragraph{Resolver la ecuación genérica}
\begin{description}  
\item $\frac{1}{c_s^{2}(x)} \frac{\partial^{2} p\prime}{\partial t^{2}} = \nabla^{2} p\prime    $
\item Reemplazando la solución WKB approx. $p(x,t) = a(x,t) e^{i \phi(x,t)}$ en la ecuación y con las definiciones de $\omega$ y k de arriba despues 
de hacer los cálculos 
y asumiendo  que las variaciones en la amplitud son muy pequeñas de forma que podemos omitir términos de segundo orden en las derivadas espaciales y temporales de a llegamos a: 
\begin{itemize}
\item $\omega^{2}(x,t) = c_s^{2}(x) k^2(x,t)$ (la relación de dispersión es válida de forma local)
\item y la ecuación de la evolución de la amplitud:
  $\frac{\partial a}{\partial t} + c_g \cdot \nabla a = -\frac{1}{2} \frac{a}{|k| c_s} (\frac{\partial \omega}{\partial t} + c_s^{2}  \nabla \cdot k) $
\end{itemize}
\item con $c_g = \frac{\partial \omega}{\partial k}$ 

\item de la relación de dispersión $\implies $ 
\item$\frac{\partial \omega}{\partial t} + c_g \cdot \nabla \omega = 0 $
\item$\frac{\partial k}{\partial t} + c_g \cdot \nabla k = -k \cdot \nabla  c_g $

\item Usamos directamente la ecuación de conservación de energía para determinar la amplitud y no la de arriba (TODO):
\item$\frac{\partial E}{\partial t} + c_g \cdot \nabla E = -E \nabla \cdot c_g $

\end{description}


\paragraph{1D} 
($c_g = c_s$):
\begin{description}  
\item$\frac{\partial k}{\partial t} + c_s \frac{\partial k}{\partial x} = -c_s $
\item$\frac{\partial \omega}{\partial t} + c_s \frac{\partial \omega}{\partial x} = 0 $
\item$\frac{\partial k}{\partial t} + c_s \frac{\partial k}{\partial x} = -k \frac{\partial c_s}{\partial x} $
\item $\frac{\partial a}{\partial t} + c_s \frac{\partial a}{\partial x} = -\frac{1}{2} \frac{a}{|k| c_s} (\frac{\partial \omega}{\partial t} + c_s^{2} \frac{\partial k}{\partial x}) $

\item$\frac{\partial E}{\partial t} + c_s \frac{\partial E}{\partial x} = -E \frac{\partial  c_s}{\partial x} $


\end{description}

Al largo de un rayo (similar a una trayectoria) $x_p(t)$ solución de :

\begin{description}  
\item$\frac{dx}{dt} = c_s $
\item$ x(0) = x_p $
\end{description}
las dependencias de x se transforman en dependencias de t reemplazando x por $x_p(t) $ 

y reemplazando en las ecuaciones de arriba obtenemos  las ecuaciones diferenciales:
\begin{description}  
\item $\frac{d\omega}{dt} = 0$
\item $\frac{dk}{dt} = -k \frac{\partial c_s}{\partial x} $
\item $\frac{da}{dt} = -\frac{1}{2} \frac{a}{|k| c_s} (\frac{\partial \omega}{\partial t} + c_s^{2}  \frac{\partial c_s}{\partial x}) $
\item$\frac{dE}{dt} = -E \frac{\partial  c_s}{\partial x} $

\end{description}
al largo del rayo
Las ecuaciones ahora no tienen mas derivadas parciales (solo dependen de t) y se pueden integrar más fácil.
\begin{description}
\item De la primera se obtiene:  
\item $ \omega(x_p(t), t)  = constant $
\end{description}
Haciendo unos cálculos:
\begin{description}  
\item $\frac{dc_s}{dt} =  \frac{\partial c_s}{\partial x} \frac{\partial x}{\partial t} = \frac{\partial c_s}{\partial x}  c_s\implies
\frac{dk}{dt} = -k  \frac{1}{c_s} \frac{dc_s}{dt} $
\item $\frac{dln(k_p)}{dt} = - \frac{dln(c_s)}{dt} \implies $
obtenemos:
\item $ k(x_p(t), t)  c_s(x_p(t)) = constant $
\item de forma similar $ E(x_p(t), t)  c_s(x_p(t)) = constant $ 
\end{description}

\textbf{Relación entre las amplitudes}

\begin{description}  
\item Suponiendo que estas soluciones existen:
\item $p\prime = P e^{i\phi}$
\item $\rho\prime = R e^{i\phi}$
\item $v = V e^{i\phi}$
\item P,R,V  complejos
\end{description}

igual que en caso homogeneo :

\begin{description}  
\item de la relación de adiabaticidad: $|P(x,t)| = c_s^{2}(x) |R(x,t)|$
\item de la ecuación de movimiento: 
\item $\rho_0 \frac{\partial v}{\partial t} = -\nabla \rho\prime \implies -i \rho_0 \omega V e^{i\phi} = i k P e^{i\phi}$
\item despues de simplificar,  multiplicar cada lado con su conjugado(hay que expresar las amplitudes locales con el módulo porque pueden ser complejas):
\item  $|V|^2 = \frac{|P|^2}{\rho_0^{2} c_s^2}$ ($|V|= \frac{1}{c_s \rho_0} |P| = \frac{c_s}{p_0 \gamma} |P|$) 


\end{description}
\begin{description}  

\item De las relaciones entre las amplitudes $ \implies \frac{\rho_0 |V|^{2}}{2} = \frac{|P|^{2}} {2 \rho_0 c_s^{2}} $
\item $E = \frac{|P|^{2}}{\rho_0 c_s^2} $ (la suma de las 2)
\item $\implies |P(x_p(t),t)|^2 \rho_0^{-1}(x_p(t))c_s^{-1}(x_p(t)) = constant $
\item Suponemos que podemos escribir :
\item $|P| = c_s^{k} \rho_0^{l} p_0^{m} C_{P}$
\item $|R| = c_s^{k} \rho_0^{l_1} p_0^{m_1} C_{R}$
\item $|V| = c_s^{k} \rho_0^{l_2} p_0^{m_2} C_{V}$
\item con $C_{P}, C_{R} y C_{V}$ constantes.
\item elegimos $k = l = \frac{1}{2}$ , $m = 0$ (TODO eso porque en realidad se puede dejar un parámetro ya que $\gamma = const = c_s^{2} \rho_0^{-1} p_0^{-1} $ y multiplicando las ecuaciones con $\gamma^{p}$ el parámtro $m\rightarrow m+p$ ? o hay que elegir porque todas las amplitudes tienen que cumplir la ecuación diferencial de la amplitud?)
\item de las relaciones entre las amplitudes de arriba 
\item $\frac{|P|}{|R|} = c_s^2 = \rho_0^{l-l_1} p_0^{m-m_1} \frac{C_{P}}{C_{R}}$
\item Escribimos $c_s^2 = \gamma p_0 \rho_0^{-1}$ y la relación de arriba se tiene que cumplir $\forall x$ (porque consideramos $c_s, \rho_0 y p_0 $ dependiendo de x)
\item $\implies m - m_1 = 1$, $l-l_1 = -1$ y $\frac{C_P}{C_R} = \gamma$
\item $\frac{|P|}{|V|} = c_s \rho_0 = \gamma^{-\frac{1}{2}} p_0^{\frac{1}{2}} \rho_0^{\frac{1}{2}} = \rho_0^{l-l_2} p_0^{m-m_2} \frac{C_P}{C_V}$
\item $\implies  \frac{C_P}{C_V} =  \gamma^{-\frac{1}{2}}, l-l_2=\frac{1}{2}. m-m_2 = \frac{1}{2} $
\item $\implies m_1=-1, l_1 = \frac{3}{2}, l_2 = 0, m_2 = -\frac{1}{2}$
 
\item $|P| = c_s^{\frac{1}{2}} \rho_0^{\frac{1}{2}}  C_{P}$
\item $|R| = c_s^{\frac{1}{2}} \rho_0^{\frac{3}{2}} p_0^{-1} \gamma^{-1} C_{P}$
\item $|V| = c_s^{\frac{1}{2}}  p_0^{-\frac{1}{2}} \gamma^{\frac{1}{2}} C_{P}$

\item Estas relaciones serían válidas aunque $p_0$ no es constante? (TODO: variando de tal forma que se cumplan las condiciones de las aproximaciones : $\rho_0, p_0, c_s$ monotonas variando lentamente)
\item y en el caso cuando $ p_0$ constante  
\item $\implies |P(x_p(t),t)| c_s^{\frac{1}{2}}(x_p(t),t) = constant $
\item Las amplitudes se calculan al largo del rayo  $x_p(t)$ (la curva solución para  $\frac{dx}{dt} = c_s, x(0) = x_p$): $C_P$ es una constante que depende de los valores en el punto inicial del rayo ($x_p$): $C_P = c_s^{-\frac{1}{2}}(x_p) , \rho_0^{\frac{1}{2}}(x_p)$

\item En la práctica he calculado la solución analítica(los valores de las amplitudes $|P|, |R|, |V|$ ) al largo del rayo $x_p(t)$:
\item $|P(x_p(t),t)| = c_s^{-\frac{1}{2}}(x_p(t)) c_s^{\frac{1}{2}}(x_p) P(x_p,0)  $
\item las amplitudes de las demás perturbaciones se calculan reemplazando directamente en las relaciones entre las amplitudes (cuando se representa la solución analítica), 
\item En el caso de la práctica queremos representar las amplitudes como $const * cs^{\alpha} $ reemplazamos $\rho_0$
\item Para ver si el paquete se adapta a la relación representamos las curvas:
\item para la presión: $ c_s^{-\frac{1}{2}}(x) c_s^{\frac{1}{2}}(x) P(x_0,0) $
\item densidad: $ c_s^{-\frac{3}{2}}(x) c_s^{\frac{3}{2}}(x_0) R(x_0,0)  $ 
\item velocidad: $ c_s^{\frac{1}{2}}(x) c_s^{-\frac{1}{2}}(x_0) V(x_0,0)  $ 
\item eligiendo $x_0$ los 2 puntos donde  los valores de las amplitudes de las perturbación en el momento inicial tienen el mínimo y máximo 


\end{description}

\section{Práctica}
\begin{description}
\item Definimos una amplitud A muy pequeña y una función periodica h en el intervalo $[x_0, x_f]$ con amplitud máxima 1 y creeamos las perturbaciones para que cumplan las relaciones entre las amplitudes de arriba:
\item  $p\prime(x,0) = \gamma p_0 h(x) $ 
\item  $\rho\prime(x,0) = \rho_0 h(x) $
\item  $v(x, t) =  c_s h(x) $
\item h periodica $\implies$ h se puede escribir como una superposición de ondas sinusoidales (componentes Fourier) que viajan a la derecha
\item En la práctica se pueden también definir superposiciones de funciones periodicas que pueden viajar en los 2 sentidos para generar las perturbaciones (condiciones iniciales) 
(definiendo A, csSign como se explicó arriba y el tipo de función para cada una  : en soundwave\_perturbation\_params.py)
\end{description}

\paragraph{Wave packet}
\begin{center}
 $h(x) = e^{- \frac{(z-zc)^2}{W^2}} cos(2 \pi  k0 \frac{z - z0}{zf - z0}) $
\end{center}

\subsection{Medio homogéneo}

\paragraph{Evolución en el tiempo de las variables}
\begin{description}
\item $A = 3e-4$
\item Como las 3 variables: $p\prime, \rho\prime, v$  cumplen las mismas ecuaciones diferenciales consideramos $h_2(x,t)$ solución de la ecuación genérica:   
 $\frac{1}{c_s^{2}} \frac{\partial^{2} h_2}{\partial t^{2}} = \frac{ \partial^{2} h_2}{\partial x^2}   $ con $c_s$ constante  y condición inicial $h_2(x,0) = h(x)$
y luego la solución de las 3 variables es multiplcar esta con las amplitudes correspondientes

\item La solución analítica (y que está implemntada) es
$h_2(x,t) = h(x - c_s t)$
\item el gráfico de la  funcion inicial (en este caso el paquete de ondas gaussian) no cambia de forma solo se traslada a la derecha con la velocidad $c_s$

\begin{figure}[!ht]
 \centering
 \includegraphics[scale=0.2]{mainhom.png}
 \caption{\emph{El paquete de ondas en medio homogeneo en varios instantes del tiempo: boundary conditions: repeat}}
\end{figure}

\item si la resolución no es buena la amplitud calculada de forma numérica puede crecer. En este caso he tomado nint = 2048 (definido en constants.py)
y parece que la solución analítica dibujada por encima de la numérica no se desvía mucho de ella.
\end{description}


\paragraph{Fourier}
\textbf{Equivalencias de las definiciones}:

\begin{description}
\item La transformada Fourier de la función h se define  (omitiendo dominios):
$F_h(k) = \int_{- \infty}^{\infty}{h(x) e^{-i k x} dx } $
 
\item para $h(x) = e^{- \frac{(z-zc)^2}{W^2}} cos(2 \pi  k0 \frac{z - z0}{zf - z0}) $

\item calculo con mathematica (de forma analítica) la siguiente integral
$f_1(k)=F_h(\frac{2\pi k}{x_f - x_0} ) = \int_{- \infty}^{\infty}{h(x) e^{-\frac{2 \pi i k x }{x_f - x_0}} dx } $

\item calculo con mathematica con FourierTransform usando FourierParameters $0, -2\pi$ (de forma analítica) y obtenemos $f_2(k)$

\item Compruebo de forma numerica y analítica que
$f_1(k) = f_2(\frac{k}{x_f - x_0})$

\item De la teoria si defino los coeficientes: $c(k) = \frac{1}{x_f - x_0} f_1(k) $
\item  $f(x) = \sum_{k=-\infty}^{\infty} c_k e^{2 \pi i k \frac{x-x_0}{x_f - x_0}}$

\item quiero representar de forma analítica y numeríca $c(k) * (x_f-x_0)$
\item de forma analítica calculo en mathematica de forma analítica  $f_1(k)$ o obtengo $f2(k)$ y represento  $f_2(\frac{k}{x_f - x_0})$

\item en python  se calculan los coeficientes $cp(k) = f_1(\frac{k}{x_f-x_0})$ asi que 
\item de forma numérica tengo que representar $cp(k* (x_f - x_0))* (x_f - x_0)$  
\end{description}

\textbf{Resultado}:
\begin{description}
\item después de hacer unos cálculos llego a 
\item $f_1(k) = \frac{W \sqrt{\pi}}{2} (g_1(k) + g_2(k)) $ con
\item $g_1(k) =  e^{-\frac{\pi \big[ \pi  W^2 (k + k_0)^2   + 2  i z_c(x_f - x_0)(k+ k_0)   - 2 k_0 i x_0 (x_f-x_0) \big]}{(x_f-x_0)^2}}$
\item $g_2(k) = e^{-\frac{\pi \big[\pi  W^2 (k - k_0)^2  +2 i z_c(x_f - x_0)(k - k_0)  + 2 k_0 i x_0 (x_f-x_0)\big]}{(x_f - x_0)^2}} $

\item Considerando $z_c$ = 0 las exponenciales $g_1$ y $g_2$ son  gaussianas  con w = $\frac{z_f - z_0}{\pi W}$ la primera centrada en $-k_0$ y la segunda en $k_0$
\item si calculamos el módulo de cada una  el modulo las constantes $ abs(exp( - 2 k_0 i z_0 (z_f-z_0))) = abs(exp( 2 k_0 i z_0 (z_f-z_0)))  = 1$
(corresponden al desplazamiento de fase por la elección de $z_c$(el centro de la función gauss) y $z_0$(el centro de la función cos ))
\item la amplitud  máxima de cada una es $\frac{W \sqrt{\pi}}{2}$ igual que se ve en el gráfico por estar bien separadas (con valores :  z0=3.100, zf = 7.400, k0 = 60, zc = 3.745, W = 0.050) : con rojo había hecho el plot de la función entera y con verde y azul de las 2 partes 

\item \begin{figure}[!ht] 
 \centering 
 \includegraphics[scale=0.5]{gauss.png} 
\end{figure} 

\end{description}
\textbf{Evolución de $f_1(k)$ en el tiempo}  $c_k * (x_f - x_0)$
\begin{description}
\item Si escribimos   $h_2(x,0) = h(x) = \sum_{k=-\infty}^{\infty}c_k e^{2 \pi i k \frac{x-x_0}{x_f-x_0}}$ 
\item $h_2(x,t) = h(x) = \sum_{k=-\infty}^{\infty}c_k e^{2 \pi i k \frac{x-c_s t-x_0}{x_f-x_0}}$ 
\item $c_s$ constante $\implies $ los coeficientes quedan los mismos 

\item \begin{figure}[!ht]
 \centering
 \includegraphics[scale=0.2]{fourhom.png}
 \caption{\emph{evolución de f1(k)}}
\end{figure}
\item Igual que se ve en el gráfico $f_1(k) $ casi no varía en el tiempo (se representó tambien la solución analítica para hacer la comparación).
La pequeña variación se debe a la resolución (la solución numérica decrece un poco)


\end{description}

\paragraph{Condiciones de contorno: reflexión}

\begin{description}
\item cambiando el parametro periodicType in soundwave\_boundary\_conditions.py  podemos  elegir las condiciones de contorno ("refl" o "repeat")
\item
\begin{figure}[!ht]
 \centering
 \includegraphics[scale=0.2]{reflhom.png}
 \caption{\emph{Evolución en el tiempo de las variables boundary conditions: refl }}
\end{figure}
\item TODO: la solución analítica con periodicType="refl" no está todavía implemnetada
\end{description}



\begin{figure}[!ht]
 \centering
 \includegraphics[scale=0.2]{mainInhom1.png}
 \caption{\emph{Perfil radial de las estrellas de referencia para la alineación}}
\end{figure}

\begin{figure}[!ht]
 \centering
 \includegraphics[scale=0.2]{rhocInhom1.png}
 \caption{\emph{Perfil radial de las estrellas de referencia para la alineación}}
\end{figure}
 

\end{document}


